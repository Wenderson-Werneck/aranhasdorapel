<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Aranhas do Rapel | Aventuras no Espírito Santo</title>
    <meta name="description" content="Viva a adrenalina do rapel com segurança total. Agenda de aventuras na Serra, Vila Velha e região.">
    
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4T08NL0VVP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4T08NL0VVP');
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>

    <style>
        /* --- RESET E VARIÁVEIS --- */
        :root {
            --es-pink: #E83D8A;
            --es-blue: #0055A4;
            --es-white: #FFFFFF;
            --primary: var(--es-pink);
            --light: #FDF2F8; 
            --dark: #1A202C;
            --success: #27ae60;
            --whatsapp: #25D366;
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Reset de Lista (Remove pontinhos) */
        ul, li { list-style: none !important; padding: 0; margin: 0; }
        
        html { scroll-behavior: smooth; }
        
        body { 
            background-color: var(--light); 
            color: var(--dark); 
            line-height: 1.6; 
            overflow-x: hidden; 
            padding-bottom: 80px; 
            padding-top: 70px; 
        }
        
        .container { width: 90%; max-width: 1200px; margin: 0 auto; }

        /* --- HEADER DESKTOP --- */
        header {
            background: var(--primary); position: fixed; width: 100%; top: 0; left: 0; z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); height: 70px;
            display: flex; align-items: center; justify-content: center;
        }

        .desktop-nav { display: flex; width: 100%; justify-content: center; align-items: center; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-links a { color: white; text-decoration: none; font-weight: 600; font-size: 1.0rem; }
        
        .nav-links .btn-login {
            background-color: white; color: var(--primary) !important; padding: 0.6rem 1.5rem !important;
            border-radius: 50px; transition: transform 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: inline-flex; align-items: center; gap: 8px; 
        }
        .nav-links .btn-login:hover { transform: translateY(-2px); background-color: #fff0f5; }

        /* --- ARANHA PENDURADA --- */
        .fixed-spider {
            position: fixed; top: 70px; left: 20px; width: 60px; z-index: 900;
            pointer-events: none; animation: swing 4s infinite ease-in-out alternate; transform-origin: top center;
        }
        .fixed-spider::before { content: ''; display: block; width: 1px; height: 50px; background: #444; margin: 0 auto; }
        .fixed-spider img { width: 100%; height: auto; display: block; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
        @keyframes swing { 0% { transform: rotate(5deg); } 100% { transform: rotate(-5deg); } }

        /* Escondidos no Desktop */
        .mobile-header-content { display: none; }
        .app-bottom-nav { display: none; }
        .mobile-sidebar { display: none; }
        .sidebar-overlay { display: none; }

        /* --- CONTEÚDO --- */
        section { padding: 4rem 0; scroll-margin-top: 90px; }
        .section-title { text-align: center; margin-bottom: 3rem; }
        .section-title h2 { font-size: 2.5rem; color: var(--primary); }
        .section-title p { color: var(--dark); opacity: 0.8; }
        .swipe-hint-text { display: none; }

        .adventures-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2.5rem; }
        .agenda-grid, .photos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 2.5rem; }
        
        .agenda-item, .adventure-card, .photo-item {
            border-radius: 12px; overflow: hidden; box-shadow: var(--shadow-lg); 
            background: var(--es-white); cursor: pointer; position: relative;
            transition: transform 0.3s ease-out; width: 100%; display: flex; flex-direction: column;
        }
        .agenda-item:hover, .adventure-card:hover { transform: translateY(-5px); }
        
        .agenda-img, .card-image img { width: 100%; height: auto; display: block; object-fit: cover; }
        .agenda-img { aspect-ratio: 4/5; }
        .card-image { height: 280px; overflow: hidden; }
        .card-image img { height: 100%; transition: transform 0.4s; }
        .adventure-card:hover .card-image img { transform: scale(1.1); }
        .photo-item .client-img { width: 100%; aspect-ratio: 4/5; object-fit: cover; display: block; }

        .agenda-content, .card-content, .photo-content { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .agenda-content { text-align: center; }
        .agenda-content h4, .photo-content h4 { color: var(--primary); margin-bottom: 0.5rem; }
        .card-content h3 { color: var(--primary); margin-bottom: 0.2rem; font-size: 1.3rem; text-align: left; }
        
        .card-meta { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #eee; margin-top: auto; }
        .difficulty { padding: 0.3rem 0.8rem; border-radius: 50px; font-weight: 700; font-size: 0.75rem; text-transform: uppercase; white-space: nowrap; }
        .difficulty.facil { background: #e8f5e9; color: var(--success); }
        .difficulty.medio { background: #fff3e0; color: #ff9800; }
        .difficulty.dificil { background: #ffebee; color: #f44336; }
        
        .photo-upload { text-align: center; margin-top: 2rem; }
        .btn-upload { display: inline-flex; gap: 8px; align-items: center; background: var(--primary); color: white; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 700; box-shadow: var(--shadow-lg); }
        
        .swal2-container { z-index: 10000 !important; }

        /* MODAL */
        .modal { 
            display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.9); z-index: 2000; overflow-y: hidden; padding: 1rem; 
            opacity: 0; visibility: hidden; pointer-events: none; /* Corrige bug fantasma */
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active { opacity: 1; visibility: visible; pointer-events: auto; }
        .modal-content { 
            background: white; margin: auto; border-radius: 20px; width: 100%; max-width: 1000px; 
            max-height: 90vh; overflow-y: auto; transform: scale(0.98); transition: transform 0.3s ease-out; 
        }
        .modal.active .modal-content { transform: scale(1); }
        .close-modal { 
            position: absolute; top: 25px; right: 30px; font-size: 2.2rem; color: white; cursor: pointer; z-index: 2001; 
            background: rgba(0, 0, 0, 0.5); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .modal-header { position: relative; height: 450px; }
        .modal-header::after { content:''; position: absolute; bottom: 0; left: 0; right: 0; height: 60%; background: linear-gradient(transparent, rgba(0,0,0,0.8)); }
        .modal-header img { width: 100%; height: 100%; object-fit: cover; }
        .modal-header-content { position: absolute; bottom: 0; left: 0; right: 0; color: white; padding: 3rem; z-index: 2; }
        .modal-header-content h2 { font-size: 3rem; color: var(--primary); text-shadow: 2px 2px 4px rgba(0,0,0,0.8); margin-bottom: 0; }
        #modalSubtitle { display: none !important; }

        .modal-body { padding: 3rem; text-align: center; }
        .modal-section { margin-bottom: 3rem; }
        .modal-section h3 { font-size: 1.8rem; color: var(--primary); margin-bottom: 1.5rem; border-bottom: 3px solid var(--accent); display: inline-block; }
        
        .adventure-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .detail-item { display: flex; flex-direction: column; align-items: center; background: var(--light); padding: 1.2rem; border-radius: 12px; box-shadow: var(--shadow-lg); border-left: 4px solid var(--accent); }
        .detail-icon { background: linear-gradient(135deg, var(--primary) 0%, #c21c66 100%); color: white; width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.8rem; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }
        .gallery-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 12px; }
        
        .agenda-modal-content { max-width: 90%; max-height: 95vh; display: flex; flex-direction: column; align-items: center; background: transparent; box-shadow: none; overflow-y: auto; }
        #agendaModalImage { width: 100%; height: auto; max-width: 550px; max-height: 75vh; object-fit: contain; border-radius: 8px; box-shadow: var(--shadow-lg); display: block; margin: 0 auto; }
        .agenda-actions { display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 15px; margin-top: 15px; width: 100%; flex-wrap: wrap; }
        
        .modal-buttons-row { display: flex; gap: 10px; justify-content: center; align-items: center; margin-top: 1rem; flex-wrap: wrap; }
        .btn-modal { 
            display: flex; align-items: center; justify-content: center; 
            gap: 8px; padding: 1rem 2rem; border-radius: 50px; text-decoration: none !important; font-weight: 700; 
            box-shadow: var(--shadow-lg); font-size: 0.9rem; transition: background 0.3s; cursor: pointer;
            width: auto; border: none; min-width: 180px; 
            color: white !important; opacity: 1 !important; visibility: visible !important;
            position: relative; z-index: 10;
        }
        .btn-reserve { background-color: #e67e22; background-image: linear-gradient(135deg, #e67e22 0%, #d35400 100%) !important; }
        .btn-whatsapp { background-color: #25D366; background-image: linear-gradient(135deg, var(--whatsapp) 0%, #128C7E 100%) !important; }
        .btn-sector { background-color: #3498db; background-image: none !important; display: none; } 
        
        footer { background: var(--dark); color: white; padding: 4rem 0 6rem; text-align: center; }
        .footer-logo-img { width: 180px; height: auto; margin-bottom: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .social-links { display: flex; gap: 1rem; justify-content: center; margin: 2rem 0; position: relative; z-index: 5; }
        .social-links a { width: 45px; height: 45px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white !important; text-decoration: none; cursor: pointer; pointer-events: auto; }

        .skeleton { background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); background-size: 200% 100%; animation: 1.5s shimmer linear infinite; border-radius: 5px; }
        @keyframes shimmer { to { background-position-x: -200%; } }
        .sk-card { height: 380px; width: 100%; border-radius: 12px; background: white; box-shadow: var(--shadow-lg); display:flex; flex-direction:column; padding:15px; gap:10px; }
        .sk-img { height: 250px; width: 100%; } .sk-title { height: 24px; width: 70%; } .sk-text { height: 16px; width: 40%; }

        /* --- MOBILE MEDIA QUERY (Responsividade) --- */
        @media (max-width: 768px) {
            .desktop-nav { display: none !important; } 
            
            .mobile-header-content { display: flex; width: 100%; height: 100%; position: relative; justify-content: center; align-items: center; padding: 0 1rem; }
            .header-brand { color: white; font-weight: 800; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
            .menu-toggle { background: none; border: none; color: white; font-size: 1.6rem; cursor: pointer; padding: 5px; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); }

            .mobile-sidebar { 
                display: flex; position: fixed; top: 0; right: -280px; width: 280px; height: 100%; 
                background: white; z-index: 3000; box-shadow: -5px 0 15px rgba(0,0,0,0.2); 
                transition: right 0.3s ease-out; flex-direction: column; 
            }
            .mobile-sidebar.active { right: 0; }
            .sidebar-overlay { display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2999; opacity: 0; visibility: hidden; transition: 0.3s; }
            .sidebar-overlay.active { opacity: 1; visibility: visible; }

            .app-bottom-nav { 
                display: flex !important; position: fixed; bottom: 0; left: 0; width: 100%; background: white; 
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; justify-content: space-around; 
                align-items: center; padding: 10px 0; padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
            }
            
            .app-nav-item {
                display: flex; flex-direction: column; align-items: center; justify-content: center;
                text-decoration: none; color: #888; font-size: 0.75rem; font-weight: 600; 
                width: 25%; transition: color 0.3s ease;
            }
            .app-nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
            .app-nav-item.active { color: var(--primary); }

            .fixed-spider { display: none; }
            header { height: 60px; } 
            .container { width: 100%; max-width: 100%; padding: 0; }
            .section-title { margin-bottom: 1.5rem; padding: 0 1rem; text-align: left; }
            .section-title h2 { font-size: 2rem; }
            section { padding: 2.5rem 0; scroll-margin-top: 80px; }
            
            .swipe-hint-text { display: block; font-size: 0.8rem; color: var(--accent); font-weight: 700; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; display: flex; align-items: center; }
            .swipe-hint-text i { margin-left: 5px; animation: slideRight 1.5s infinite; }
            @keyframes slideRight { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
            
            .agenda-grid, .adventures-grid, .photos-grid { display: flex; overflow-x: auto; gap: 1rem; padding: 10px 20px; padding-right: 40px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
            .agenda-grid::-webkit-scrollbar, .adventures-grid::-webkit-scrollbar, .photos-grid::-webkit-scrollbar { display: none; }
            
            .agenda-item, .adventure-card, .photo-item { min-width: 80vw; width: 80vw; scroll-snap-align: center; margin-bottom: 15px; height: auto; }
            .modal { align-items: center; padding: 1rem; }
            .modal-content { border-radius: 20px; min-height: auto; transform: none; margin: 0; max-height: 85vh; overflow-y: auto; }
            .modal.active .modal-content { transform: none; }
            .agenda-modal-content { width: 100%; }
            .modal-header { height: 250px; }
            .modal-header-content h2 { font-size: 2rem; }
            .modal-body { padding: 1.5rem; padding-bottom: 80px; }
            .close-modal { position: fixed; top: 15px; right: 15px; width: 40px; height: 40px; font-size: 1.5rem; }
            .agenda-actions { flex-direction: column; gap: 10px; }
            .btn-whatsapp, .btn-sector, .btn-reserve { width: 100%; font-size: 1rem; }
            #agendaModalImage { max-height: 65vh; } 
        }

        /* --- CORREÇÃO DE PRINT --- */
        @media print {
            body { padding-top: 0; padding-bottom: 0; background: white; color: black; }
            header, .app-bottom-nav, .fixed-spider, .mobile-sidebar, .sidebar-overlay, .photo-upload, .swipe-hint-text, .close-modal { display: none !important; }
            .section-title h2 { color: black; }
            .agenda-grid, .adventures-grid, .photos-grid { display: block; overflow: visible; }
            .agenda-item, .adventure-card, .photo-item { page-break-inside: avoid; margin-bottom: 20px; border: 1px solid #ccc; box-shadow: none; width: 100%; }
            .modal { position: relative; opacity: 1; visibility: visible; }
            .modal-content { max-height: none; overflow: visible; }
        }
    </style>
</head>
<body>
    
    <div class="fixed-spider">
        <img src="aranha-logo.png" alt="Aranha">
    </div>

    <div class="mobile-sidebar" id="mobileSidebar">
        <div class="sidebar-header">
            <h3>Menu</h3>
            <button id="closeSidebarBtn" class="close-sidebar">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-login-area" id="sidebarLoginArea">
                <p>Bem-vindo, aventureiro!</p>
                <a href="login.html" class="btn-login-mobile" id="mobileLoginBtn">
                    <i class="fas fa-user"></i> Fazer Login
                </a>
            </div>
            <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 1.5rem;">
            <ul class="sidebar-links">
                <li><a href="#agenda"><i class="fas fa-calendar-alt"></i> Agenda</a></li>
                <li><a href="#adventures"><i class="fas fa-mountain"></i> Aventuras</a></li>
                <li><a href="#client-photos"><i class="fas fa-camera"></i> Mural</a></li>
                <li><a href="#dicas"><i class="fas fa-lightbulb"></i> Dicas &nbsp;<span class="badge-new">Novo</span></a></li>
                <li><a href="#" id="sidebarWhatsapp"><i class="fab fa-whatsapp"></i> Contato</a></li>
            </ul>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav class="app-bottom-nav">
        <a href="#agenda" class="app-nav-item">
            <i class="fas fa-calendar-alt"></i>
            <span>Agenda</span>
        </a>
        <a href="#adventures" class="app-nav-item">
            <i class="fas fa-mountain"></i>
            <span>Aventuras</span>
        </a>
        <a href="#client-photos" class="app-nav-item">
            <i class="fas fa-camera"></i>
            <span>Mural</span>
        </a>
        <a href="#" id="mobileWhatsappBtn" class="app-nav-item">
            <i class="fab fa-whatsapp"></i>
            <span>Contato</span>
        </a>
    </nav>

    <header id="mainHeader">
        <div class="container">
            <nav class="desktop-nav">
                <ul class="nav-links" id="navLinks">
                    <li><a href="#agenda">Agenda</a></li>
                    <li><a href="#adventures">Aventuras</a></li>
                    <li><a href="#client-photos">Mural</a></li>
                    <li><a href="#dicas">Dicas</a></li>
                    <li><a href="login.html" class="btn-login" id="desktopLoginBtn"><i class="fas fa-user"></i> Entrar</a></li>
                </ul>
            </nav>
            <div class="mobile-header-content">
                <div class="header-brand">Aranhas do Rapel</div>
                <button id="mobileMenuBtn" class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <section class="agenda" id="agenda">
        <div class="container">
            <div class="section-title">
                <h2>Agenda</h2>
                <p>Confira as próximas saídas e garanta sua vaga!</p>
                <span class="swipe-hint-text">Arraste para o lado <i class="fas fa-chevron-right"></i></span>
            </div>
            <div class="agenda-grid" id="agendaGrid"></div>
        </div>
    </section>

    <section class="adventures" id="adventures">
        <div class="container">
            <div class="section-title">
                <h2>Nossas Aventuras</h2>
                <p>Descubra os locais incríveis onde vivemos as melhores experiências.</p>
                <span class="swipe-hint-text">Arraste para o lado <i class="fas fa-chevron-right"></i></span>
            </div>
            <div class="adventures-grid" id="adventuresGrid"></div>
        </div>
    </section>

    <section class="client-photos" id="client-photos">
        <div class="container">
            <div class="section-title">
                <h2>Mural dos Aranhas</h2>
                <p>Momentos inesquecíveis de quem já se aventurou conosco.</p>
                <span class="swipe-hint-text">Arraste para o lado <i class="fas fa-chevron-right"></i></span>
            </div>
            <div class="photos-grid" id="photosGrid"></div>
            <div class="photo-upload">
                <a href="#" id="btnSendPhoto" class="btn-upload"><i class="fas fa-camera"></i> Enviar Minha Foto</a>
            </div>
        </div>
    </section>

    <section class="tips" id="dicas" style="background: white;">
        <div class="container">
            <div class="section-title">
                <h2>Dicas de Rapel</h2>
                <p>Prepare-se para sua aventura com nossas recomendações.</p>
            </div>
            <div style="text-align: center; padding: 2rem; background: var(--light); border-radius: 12px;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-hard-hat"></i> Segurança em Primeiro Lugar</h3>
                <p>Em breve postaremos dicas exclusivas sobre equipamentos, vestimentas e preparação física!</p>
            </div>
        </div>
    </section>

    <div class="modal" id="adventureModal">
        <div class="close-modal" id="closeModal">&times;</div>
        <div class="modal-content">
            <div class="modal-header">
                <img id="modalImage" src="" alt="">
                <div class="modal-header-content">
                    <h2 id="modalTitle"></h2>
                    <p id="modalSubtitle" style="display:none !important;"></p>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3>Detalhes da Aventura</h3>
                    <div class="adventure-details" id="adventureDetails"></div>
                </div>
                <div class="modal-section">
                    <h3>Descrição</h3>
                    <p id="adventureDescription"></p>
                </div>
                <div class="modal-section">
                    <h3>Galeria</h3>
                    <div class="gallery" id="adventureGallery"></div>
                </div>
                <div class="modal-section modal-buttons-row">
                    <a href="#" class="btn-modal btn-reserve" id="reserveButton" style="display:none !important;">
                        <i class="fas fa-ticket-alt"></i> Reservar Vaga
                    </a>
                    
                    <a href="#" class="btn-modal btn-whatsapp" id="whatsappButton" target="_blank">
                        <i class="fab fa-whatsapp"></i> Saiba mais
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="agendaModal">
        <div class="close-modal" id="closeAgendaModal">&times;</div>
        <div class="agenda-modal-content">
            <img id="agendaModalImage" src="" alt="">
            <div class="agenda-actions">
                <button class="btn-modal btn-reserve" id="btnReserveSpot">
                    <i class="fas fa-ticket-alt"></i> Reservar Vaga
                </button>
                <a href="#" class="btn-modal btn-whatsapp" id="agendaModalButton" target="_blank">
                    <i class="fab fa-whatsapp"></i> Falar com Equipe
                </a>
                <a href="#" class="btn-modal btn-sector" id="agendaSectorBtn" style="display:none !important;">
                    <i class="fas fa-map-marked-alt"></i> Ver Setor
                </a>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <img src="social-share.jpg" alt="Logo Aranhas" class="footer-logo-img">
                <p>Segurança, Adrenalina e Conexão com a Natureza.</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/aranhas.rapel" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/aranhas.rapel/" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.tiktok.com/@aranhasdorapel?_r=1&_t=ZS-91GP46a5JG3" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a href="#" id="footerWhatsapp"><i class="fab fa-whatsapp"></i></a>
                </div>
                <p class="copyright">&copy; 2025 Aranhas do Rapel. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // CONFIGURAÇÕES
        const SUPABASE_URL = 'https://rfgijfpokictktdrenbl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmZ2lqZnBva2ljdGt0ZHJlbmJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NTYyNjUsImV4cCI6MjA3ODQzMjI2NX0.xvQBUxEtH8pad25fac6lDU4WbD-fI3L6BcRO9bsO0GE';
        const whatsappNumber = '5527995335559';
        const MP_PUBLIC_KEY = 'APP_USR-e0f74881-fec0-4f1a-9aaf-44313bd17b04';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const mp = new MercadoPago(MP_PUBLIC_KEY);

        const CACHE_KEY = 'aranhas_data_v1';
        const CACHE_EXPIRY = 15 * 60 * 1000;

        function renderSkeleton(containerId, count) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for(let i=0; i<count; i++) {
                container.innerHTML += `<div class="sk-card skeleton"><div class="sk-img skeleton"></div><div class="sk-content"><div class="sk-title skeleton"></div><div class="sk-text skeleton"></div><div class="sk-price skeleton"></div></div></div>`;
            }
        }

        async function loadDataWithCache() {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                const { timestamp, data } = JSON.parse(cached);
                if (Date.now() - timestamp < CACHE_EXPIRY) {
                    renderAll(data);
                    checkLoginState();
                    return;
                }
            }
            renderSkeleton('agendaGrid', 4);
            renderSkeleton('adventuresGrid', 4);
            renderSkeleton('photosGrid', 4);
            try {
                const [agendaRes, advRes, muralRes] = await Promise.all([
                    supabase.from('agenda').select('*').order('display_order', { ascending: true }),
                    supabase.from('aventuras').select('*').order('created_at', { ascending: false }),
                    supabase.from('mural').select('*').eq('status', 'approved').order('created_at', { ascending: false })
                ]);
                const freshData = { agenda: agendaRes.data || [], adventures: advRes.data || [], mural: muralRes.data || [] };
                localStorage.setItem(CACHE_KEY, JSON.stringify({ timestamp: Date.now(), data: freshData }));
                renderAll(freshData);
                checkLoginState();
            } catch (error) { console.error("Erro:", error); }
        }

        let allAdventures = []; let allAgenda = []; let currentUser = null; let currentAgendaItem = null;

        function renderAll(data) {
            allAdventures = data.adventures; allAgenda = data.agenda;
            renderAgenda(data.agenda); renderAdventures(data.adventures); renderMural(data.mural);
        }

        function renderAgenda(items) {
            const grid = document.getElementById('agendaGrid'); grid.innerHTML = '';
            items.forEach(item => {
                const card = document.createElement('div'); card.className = 'agenda-item';
                const priceTag = item.price ? `<span style="display:block; color:#27ae60; font-weight:bold; font-size:0.9rem; margin-top:5px;">R$ ${item.price}</span>` : '';
                card.innerHTML = `<img src="${item.image_url}" class="agenda-img" loading="lazy"><div class="agenda-content"><h4>${item.title}</h4><p>${item.date_text}</p>${priceTag}</div>`;
                card.addEventListener('click', () => openAgendaModal(item));
                grid.appendChild(card);
            });
            checkPendingReservation(items);
        }

        function renderAdventures(items) {
            const grid = document.getElementById('adventuresGrid'); grid.innerHTML = '';
            items.forEach(adv => {
                const card = document.createElement('div'); card.className = 'adventure-card';
                card.innerHTML = `<div class="card-image"><img src="${adv.image_url}" loading="lazy"></div><div class="card-content"><h3>${adv.title}</h3><div class="card-meta"><span class="difficulty ${adv.difficulty}">${adv.difficulty}</span><div class="duration"><i class="far fa-clock"></i> ${adv.duration}</div></div></div>`;
                card.addEventListener('click', () => openAdventureModal(adv));
                grid.appendChild(card);
            });
        }

        function renderMural(items) {
            const grid = document.getElementById('photosGrid'); grid.innerHTML = '';
            items.forEach(item => {
                const card = document.createElement('div'); card.className = 'photo-item';
                card.innerHTML = `<img src="${item.image_url}" class="client-img" loading="lazy"><div class="photo-content"><h4>${item.title}</h4><p>"${item.quote}"</p><small>- ${item.author}</small></div>`;
                grid.appendChild(card);
            });
        }

        const advModal = document.getElementById('adventureModal');
        const agModal = document.getElementById('agendaModal');
        const btnReserveSpot = document.getElementById('btnReserveSpot');
        const agendaSectorBtn = document.getElementById('agendaSectorBtn');

        function openModal(el) { el.classList.add('active'); document.body.style.overflow = 'hidden'; history.pushState({modal:true}, "", location.href); }
        function closeModal(el) { el.classList.remove('active'); document.body.style.overflow = 'auto'; }
        window.addEventListener('popstate', () => { closeModal(advModal); closeModal(agModal); });
        document.getElementById('closeModal').onclick = () => closeModal(advModal);
        document.getElementById('closeAgendaModal').onclick = () => closeModal(agModal);

        function openAgendaModal(item) {
            currentAgendaItem = item;
            document.getElementById('agendaModalImage').src = item.image_url;
            document.getElementById('agendaModalButton').href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent('Dúvida: '+item.title)}`;
            const related = allAdventures.find(a => a.id === item.adventure_id);
            if(related) {
                agendaSectorBtn.style.setProperty('display', 'inline-flex', 'important');
                agendaSectorBtn.onclick = (e) => { e.preventDefault(); closeModal(agModal); setTimeout(() => openAdventureModal(related), 100); };
            } else { agendaSectorBtn.style.setProperty('display', 'none', 'important'); }
            openModal(agModal);
        }

        function openAdventureModal(adv) {
            document.querySelector('#adventureModal .modal-content').scrollTop = 0;
            document.getElementById('modalTitle').textContent = adv.title;
            document.getElementById('modalImage').src = adv.image_url;
            document.getElementById('adventureDescription').textContent = adv.description;
            document.getElementById('whatsappButton').href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent('Olá, tenho dúvidas sobre: '+adv.title)}`;
            const activeEvent = allAgenda.find(item => item.adventure_id === adv.id);
            const reserveBtn = document.getElementById('reserveButton');
            if (activeEvent) {
                reserveBtn.style.setProperty('display', 'inline-flex', 'important');
                reserveBtn.onclick = (e) => { e.preventDefault(); closeModal(advModal); setTimeout(() => openAgendaModal(activeEvent), 100); };
            } else { reserveBtn.style.setProperty('display', 'none', 'important'); }
            const det = document.getElementById('adventureDetails'); det.innerHTML = '';
            if(adv.details) adv.details.forEach(d => det.innerHTML += `<div class="detail-item"><div class="detail-icon"><i class="${d.icon}"></i></div><div class="detail-text"><h4>${d.label}</h4><p>${d.value}</p></div></div>`);
            const gal = document.getElementById('adventureGallery'); gal.innerHTML = '';
            (adv.gallery_images||[adv.image_url]).forEach(img => gal.innerHTML += `<div class="gallery-item"><img src="${img}"></div>`);
            openModal(advModal);
        }

        async function checkLoginState() {
            const { data: { session } } = await supabase.auth.getSession();
            const isRedirect = location.hash && location.hash.includes('access_token');
            if (session) {
                currentUser = session.user;
                if(isRedirect && !localStorage.getItem('pendingAgendaId')) { location.href = 'dashboard.html'; return; }
                const dBtn = document.getElementById('desktopLoginBtn');
                if(dBtn) { dBtn.href = 'dashboard.html'; dBtn.innerHTML = '<i class="fas fa-user-circle"></i> Minha Conta'; }
                
                // ATUALIZAÇÃO DO SIDEBAR COM FOTO (LAYOUT BONITO)
                const sidebarArea = document.getElementById('sidebarLoginArea');
                const avatarUrl = currentUser.user_metadata.avatar_url || `https://ui-avatars.com/api/?name=${currentUser.email}&background=E83D8A&color=fff`;
                const name = currentUser.user_metadata.full_name || 'Aventureiro';
                
                sidebarArea.innerHTML = `
                    <div style="display:flex; flex-direction:column; align-items:center; gap:10px;">
                        <img src="${avatarUrl}" style="width:70px; height:70px; border-radius:50%; border:3px solid white; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
                        <div style="text-align:center;">
                            <strong style="display:block; font-size:1.1rem; color:var(--dark);">${name}</strong>
                            <a href="dashboard.html" style="color:var(--primary); font-weight:bold; text-decoration:none; font-size:0.9rem;">Acessar Painel <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                `;
            }
        }

        function checkPendingReservation(agendaItems) {
            const pid = localStorage.getItem('pendingAgendaId');
            if(pid && currentUser) {
                const item = agendaItems.find(i => i.id == pid);
                if(item) { openAgendaModal(item); localStorage.removeItem('pendingAgendaId'); }
            }
        }

        document.getElementById('btnSendPhoto').addEventListener('click', async (e) => {
            e.preventDefault();
            if(currentUser) { window.location.href = 'dashboard.html?section=estudio'; } 
            else {
                localStorage.setItem('redirectAfterLogin', 'dashboard.html?section=estudio');
                Swal.fire({ title: 'Faça Login', text: 'Para postar no mural e ganhar pontos, você precisa entrar na sua conta.', icon: 'info', confirmButtonText: 'Entrar Agora', confirmButtonColor: '#E83D8A' }).then(() => window.location.href = 'login.html');
            }
        });

        btnReserveSpot.addEventListener('click', async () => {
            if(!currentUser) { localStorage.setItem('pendingAgendaId', currentAgendaItem.id); location.href = 'login.html'; return; }
            Swal.fire({
                title: 'Confirmar Reserva',
                html: `Evento: <b>${currentAgendaItem.title}</b><br>Valor: <b style="color:#E83D8A">R$ ${currentAgendaItem.price}</b>`,
                showCancelButton: true, confirmButtonText: 'Pagar PIX', cancelButtonText: 'Cancelar', confirmButtonColor: '#E83D8A'
            }).then(async (res) => {
                if(res.isConfirmed) {
                    const { data: booking } = await supabase.from('bookings').insert([{ user_id: currentUser.id, agenda_id: currentAgendaItem.id, status: 'pendente', amount: currentAgendaItem.price }]).select().single();
                    processPayment(booking.id, currentAgendaItem.price, `Reserva: ${currentAgendaItem.title}`);
                }
            });
        });

        async function processPayment(id, amount, desc) {
            Swal.fire({ title: 'Gerando PIX...', didOpen: () => Swal.showLoading() });
            try {
                const res = await fetch("https://api.aranhasdorapel.com.br/webhook/gerar-pix", {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ transaction_amount: parseFloat(amount), description: desc, payer: { email: currentUser.email, first_name: "Cliente", identification: { type: "CPF", number: "19119119100" } } })
                });
                const data = await res.json();
                if(data.point_of_interaction) {
                    await supabase.from('bookings').update({ payment_id: data.id.toString() }).eq('id', id);
                    const qr = data.point_of_interaction.transaction_data.qr_code;
                    const b64 = data.point_of_interaction.transaction_data.qr_code_base64;
                    Swal.fire({
                        title: 'Pagamento PIX',
                        html: `<img src="data:image/png;base64,${b64}" style="width:200px;display:block;margin:auto"><textarea id="pix" style="width:100%;margin-top:10px" readonly>${qr}</textarea><button onclick="document.getElementById('pix').select();document.execCommand('copy');" class="swal2-confirm swal2-styled" style="background:#25D366;margin-top:10px">Copiar Código</button>`,
                        showCancelButton: true, cancelButtonText: 'Fechar', confirmButtonText: '<i class="fab fa-whatsapp"></i> Enviar Comprovante', confirmButtonColor: '#25D366'
                    }).then((result) => { if (result.isConfirmed) { window.open(`https://wa.me/${whatsappNumber}?text=Olá! Acabei de pagar a reserva: ${desc}`, '_blank'); } });
                } else throw new Error();
            } catch { Swal.fire('Erro', 'Tente novamente.', 'error'); }
        }

        const menuBtn = document.getElementById('mobileMenuBtn');
        const closeBtn = document.getElementById('closeSidebarBtn');
        const sidebar = document.getElementById('mobileSidebar');
        const overlay = document.getElementById('sidebarOverlay');
        function toggleSidebar() { sidebar.classList.toggle('active'); overlay.classList.toggle('active'); }
        if(menuBtn) menuBtn.addEventListener('click', toggleSidebar);
        if(closeBtn) closeBtn.addEventListener('click', toggleSidebar);
        if(overlay) overlay.addEventListener('click', toggleSidebar);

        // --- SCROLL SPY (Ativa botão rosa automaticamente) ---
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            const navItems = document.querySelectorAll('.app-nav-item');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= (sectionTop - 150)) { // Offset do header
                    current = section.getAttribute('id');
                }
            });

            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href').includes(current)) {
                    item.classList.add('active');
                }
            });
        });

        const waLink = `https://wa.me/${whatsappNumber}`;
        document.getElementById('footerWhatsapp').href = waLink;
        document.getElementById('mobileWhatsappBtn').href = waLink;
        document.getElementById('sidebarWhatsapp').href = waLink;

        document.addEventListener('DOMContentLoaded', loadDataWithCache);

    </script>
</body>
</html>